#!/bin/bash

#
# Generated by Chef for <%= node[:fqdn] %>
#

if [ $# != 1 ]; then
  echo "Takes one parameter"
  exit
fi

<% @backup_scheme.each do |routine| -%>
# <%= routine['name'] %> START

  cd <%= @backup_dir %>/<%= routine['name'] %>  
  if [ $? == 0 ]; then
    <% if routine['lifespan']['hours'] != nil %>
    find . -mmin +<%= routine['lifespan']['hours'] * 60 %> -exec rm {} \;
    <% elsif routine['lifespan']['days'] != nil %>
    find . -mtime +<%= routine['lifespan']['days'] %> -exec rm {} \;
    <% end %>
    if [ $1 == "<%= routine['name'] %>" ]; then
      tar -cvf $(date +"<%= @backup_format %>").tar <%= @minecraft_dir %>/world
    fi
  fi

# <%= routine['name'] %> END
<% end -%> 
